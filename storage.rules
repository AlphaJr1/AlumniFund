rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper function untuk check admin by email
    function isAdmin() {
      return request.auth != null && request.auth.token.email == 'adrianalfajri@gmail.com';
    }
    
    // Proof images (transaction proofs)
    match /proof_images/{allPaths=**} {
      // Public read access
      allow read: if true;
      
      // Public can upload (for donation proof) - NO AUTH REQUIRED
      allow create: if true;  // Allow anyone to upload
      
      // Only admin can delete
      allow delete: if isAdmin();
    }
    
    // QR codes
    match /qr_codes/{allPaths=**} {
      // Public read access
      allow read: if true;
      
      // Only admin can upload/update/delete
      allow write: if isAdmin()
        && request.resource.size < 2 * 1024 * 1024  // Max 2MB
        && request.resource.contentType.matches('image/.*');  // Only images
    }
    
    // Distribution proofs (bukti distribusi dana ke wisudawan)
    match /distribution_proofs/{allPaths=**} {
      // Public read access
      allow read: if true;
      
      // Only admin can upload
      allow create: if isAdmin()
        && request.resource.size < 10 * 1024 * 1024;  // Max 10MB (support PDF)
      
      // Only admin can delete
      allow delete: if isAdmin();
    }
  }
}
