# **PROMPT 2: ADMIN PANEL - COMPLETE SPECIFICATION**

```markdown
# DOMPET ALUMNI - PHASE 2: ADMIN PANEL & MANAGEMENT SYSTEM

## CONTEXT FROM PHASE 1

This is a continuation of the Dompet Alumni project. Phase 1 implemented:
- Public dashboard with real-time Firestore data
- Donation modal for proof submissions
- Database schema in Firestore
- Security rules for public access

**Phase 2 adds**: Complete admin panel for fund management, transaction validation, and target creation.

---

## ADMIN AUTHENTICATION SYSTEM

### Login Page

**Route**: `/admin/login`
**Access**: Public (unauthenticated users only)
**Redirect**: If already logged in â†’ `/admin/dashboard`

**Layout**:
```
Full-screen centered layout with gradient background

Background:
  - Gradient: Teal (#14b8a6) to dark teal (#0d9488)
  - Pattern overlay: Subtle diagonal lines (optional)

Card container:
  - Width: 400px (desktop), 90% (mobile)
  - Max-width: 400px
  - Background: White
  - Border radius: 16px
  - Shadow: 0 8px 32px rgba(0,0,0,0.15)
  - Padding: 40px

Content (Vertical stack):
  
  Logo/Icon section:
    - Icon: "ğŸ”‘" (48px)
    - Margin bottom: 16px
  
  Title:
    - Text: "ADMIN LOGIN"
    - Font: Bold, 24px
    - Color: Dark gray (#111827)
    - Margin bottom: 8px
  
  Subtitle:
    - Text: "Dompet Alumni Dashboard"
    - Font: Regular, 14px
    - Color: Gray (#6B7280)
    - Margin bottom: 32px
  
  Form:
    Email field:
      - Label: "Email Admin"
      - Placeholder: "admin@example.com"
      - Type: email
      - Height: 48px
      - Border: 1px solid gray (#D1D5DB)
      - Border radius: 8px
      - Focus: Border teal, shadow teal
      - Margin bottom: 16px
    
    Password field:
      - Label: "Password"
      - Placeholder: "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
      - Type: password (with show/hide toggle)
      - Height: 48px
      - Border: 1px solid gray
      - Border radius: 8px
      - Show/hide icon: Eye icon (right side)
      - Margin bottom: 8px
    
    Remember me checkbox (optional):
      - Text: "Tetap login"
      - Margin bottom: 24px
    
    Error message area:
      - Display: Conditional (if login fails)
      - Background: Light red (#FEE2E2)
      - Border: 1px solid red (#EF4444)
      - Border radius: 6px
      - Padding: 12px
      - Text: Error message from Firebase
      - Color: Red (#DC2626)
      - Margin bottom: 16px
    
    Login button:
      - Text: "Login"
      - Width: 100%
      - Height: 48px
      - Background: Teal (#14b8a6)
      - Color: White
      - Font: Bold, 16px
      - Border: None
      - Border radius: 8px
      - Disabled state: Gray background, cursor not-allowed
      - Loading state: Show spinner, text "Memproses..."
      - Click: Attempt Firebase Auth login
```

**Authentication Logic**:
```dart
Future<void> login(String email, String password) async {
  try {
    final credential = await FirebaseAuth.instance.signInWithEmailAndPassword(
      email: email,
      password: password,
    );
    
    // Verify user is admin (check email against whitelist)
    if (credential.user?.email == 'admin@example.com') {
      // Redirect to /admin/dashboard
      Navigator.pushReplacementNamed(context, '/admin/dashboard');
    } else {
      // Not admin - sign out and show error
      await FirebaseAuth.instance.signOut();
      showError('Akun ini tidak memiliki akses admin');
    }
  } on FirebaseAuthException catch (e) {
    if (e.code == 'user-not-found') {
      showError('Email tidak ditemukan');
    } else if (e.code == 'wrong-password') {
      showError('Password salah');
    } else {
      showError('Login gagal: ${e.message}');
    }
  }
}
```

**Security**:
- Admin email hardcoded in app config (can be env variable)
- Session persists across app restarts (Firebase Auth handles this)
- Auto-logout after 7 days inactivity (configurable)

---

## ADMIN DASHBOARD LAYOUT

### Overall Structure

**Route**: `/admin/dashboard`
**Access**: Authenticated admin only
**Layout**: Two-column (desktop), single-column (mobile)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TOP NAVBAR (Fixed)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                           â”‚
â”‚ SIDEBAR  â”‚  MAIN CONTENT AREA                        â”‚
â”‚ (Fixed)  â”‚  (Scrollable)                             â”‚
â”‚          â”‚                                           â”‚
â”‚          â”‚  - Active view based on sidebar selection â”‚
â”‚          â”‚  - Default: Dashboard Overview            â”‚
â”‚          â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### TOP NAVBAR (Fixed)

**Position**: Fixed top, full width
**Height**: 64px
**Background**: White (#FFFFFF)
**Border bottom**: 1px solid light gray (#E5E7EB)
**Z-index**: 1001

**Content (Horizontal flexbox, space-between):**

```
Left section:
  - Icon + Title: "ğŸ“ ADMIN PANEL"
  - Font: Bold, 18px
  - Color: Dark gray (#111827)

Right section:
  - Admin info display:
    * Icon: "ğŸ‘¤"
    * Text: "Admin" (or email if available)
    * Font: Regular, 14px
    * Color: Gray (#6B7280)
  
  - Divider: Vertical line (1px, gray)
  
  - Logout button:
    * Icon: "ğŸšª"
    * Text: "Logout"
    * Background: Transparent
    * Color: Red (#DC2626)
    * Padding: 8px 16px
    * Border radius: 6px
    * Hover: Background light red
    * Click: Sign out and redirect to login
```

---

### SIDEBAR (Left Column)

**Position**: Fixed left side (desktop), drawer (mobile)
**Width**: 240px (desktop), full screen (mobile)
**Background**: Dark gray (#1F2937)
**Height**: calc(100vh - 64px) (below navbar)

**Navigation Menu (Vertical stack):**

```
Each menu item:
  - Height: 48px
  - Padding: 12px 16px
  - Cursor: Pointer
  - Hover: Background rgba(255,255,255,0.1)
  - Active: Background teal (#14b8a6), text white
  - Default: Text light gray (#D1D5DB)
  
  Layout (Horizontal):
    - Icon: 24px (left)
    - Spacing: 12px
    - Label: 14px font

Menu items (in order):

1. Dashboard Overview
   - Icon: "ğŸ“Š"
   - Label: "Dashboard"
   - Route: /admin/dashboard (default view)

2. Validate Income
   - Icon: "ğŸ’°"
   - Label: "Validasi Pemasukkan"
   - Badge: Red circle with count if pending > 0
   - Route: /admin/validate-income

3. Input Expense
   - Icon: "ğŸ“¤"
   - Label: "Input Pengeluaran"
   - Route: /admin/input-expense

4. Manage Targets
   - Icon: "ğŸ¯"
   - Label: "Kelola Target Wisuda"
   - Route: /admin/manage-targets

5. Settings
   - Icon: "âš™ï¸"
   - Label: "Pengaturan"
   - Route: /admin/settings

Divider: Horizontal line (1px, gray opacity)

6. Logout (bottom of sidebar)
   - Icon: "ğŸšª"
   - Label: "Logout"
   - Color: Light red
   - Position: Bottom of sidebar
   - Click: Sign out
```

**Mobile Behavior**:
- Sidebar hidden by default
- Show hamburger menu icon in navbar
- Sidebar opens as drawer overlay from left
- Close on item click or backdrop tap

---

### MAIN CONTENT AREA

**Position**: Right of sidebar (desktop), full width (mobile)
**Padding**: 24px
**Background**: Light gray (#F9FAFB)
**Min-height**: calc(100vh - 64px)

**Content changes based on active view (see sections below)**

---

## ADMIN VIEW 1: DASHBOARD OVERVIEW

**Default view when admin logs in**

**Layout (Vertical stack):**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 1: METRICS CARDS (Horizontal grid, 4 columns)

Card structure (each):
  - Width: 100% / 4 (desktop), 100% / 2 (tablet), 100% (mobile)
  - Height: 120px
  - Background: White
  - Border radius: 12px
  - Padding: 20px
  - Shadow: Subtle elevation
  - Layout (Vertical):
    * Icon (top, 32px)
    * Label (medium, gray, 13px)
    * Value (large, bold, teal/red/green, 24px)

Card 1: General Fund Balance
  - Icon: "ğŸ’°"
  - Label: "Saldo Dompet Bersama"
  - Value: "Rp [formatted_balance]"
  - Value color: Teal (#14b8a6)

Card 2: Active Target Status
  - Icon: "ğŸ¯"
  - Label: "Target Aktif"
  - Value: "[Month Year]" OR "Tidak ada"
  - Value color: Dark gray (if exists) or Light gray (if none)

Card 3: Nearest Deadline
  - Icon: "â°"
  - Label: "Deadline Terdekat"
  - Value: "[X] hari lagi" OR "-"
  - Value color: Orange (if < 7 days), Green (if >= 7), Gray (if none)

Card 4: Pending Validations
  - Icon: "â¤ï¸"
  - Label: "Pending Validasi"
  - Value: "[N] pemasukkan"
  - Value color: Red (if > 0), Green (if 0)
  - Clickable: Navigate to Validate Income view

Margin bottom: 24px

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 2: QUICK ACTIONS (Horizontal flexbox, gap 12px)

Button structure (each):
  - Height: 44px
  - Padding: 12px 20px
  - Border radius: 8px
  - Font: Medium, 14px

Button 1: Input Income
  - Icon: "â•"
  - Text: "Input Pemasukkan"
  - Background: Green (#16A34A)
  - Color: White
  - Click: Open income input modal

Button 2: Input Expense
  - Icon: "â•"
  - Text: "Input Pengeluaran"
  - Background: Red (#DC2626)
  - Color: White
  - Click: Navigate to Input Expense view

Button 3: Create Target
  - Icon: "ğŸ¯"
  - Text: "Buat Target Baru"
  - Background: Teal (#14b8a6)
  - Color: White
  - Click: Navigate to Manage Targets view (create mode)

Margin bottom: 32px

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 3: RECENT ACTIVITY TABLE

Header:
  - Text: "ğŸ“Š Aktivitas Terbaru"
  - Font: Bold, 18px
  - Margin bottom: 16px

Table container:
  - Width: 100%
  - Background: White
  - Border radius: 12px
  - Overflow: Auto scroll (horizontal on mobile)

Table structure:
  - Columns: Type | Amount | Target/Category | Description | Timestamp | Actions
  - Header row:
    * Background: Light gray (#F3F4F6)
    * Font: Semi-bold, 13px
    * Color: Gray (#6B7280)
    * Padding: 12px
  
  Data rows (latest 20 transactions, mixed income + expense):
    - Height: 56px
    - Border bottom: 1px solid light gray
    - Hover: Background light gray
    - Padding: 12px
    
    Column 1: Type
      - Display: Icon + label
      - Income: "â†“" green icon
      - Expense: "â†‘" red icon
      - Width: 10%
    
    Column 2: Amount
      - Display: "Rp [amount]"
      - Font: Bold, 14px
      - Color: Green (income) or Red (expense)
      - Width: 15%
    
    Column 3: Target/Category
      - Income: "[Month Year]" or "Dompet Bersama"
      - Expense: Category name
      - Font: Regular, 13px
      - Width: 20%
    
    Column 4: Description
      - Display: Full description (truncated if > 50 chars with tooltip)
      - Font: Regular, 13px
      - Width: 30%
    
    Column 5: Timestamp
      - Display: "[DD/MM/YYYY HH:MM]"
      - Font: Regular, 12px
      - Color: Gray
      - Width: 15%
    
    Column 6: Actions
      - Buttons (horizontal):
        * "View Proof" (eye icon) â†’ Open image modal
        * "Edit" (pencil icon) â†’ Edit transaction (if within 24h)
        * "Delete" (trash icon) â†’ Delete with confirmation
      - Width: 10%

Empty state (if no transactions):
  - Icon: "ğŸ“­"
  - Text: "Belum ada transaksi"
  - Center-aligned

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ADMIN VIEW 2: VALIDATE INCOME

**Purpose**: Review and approve pending income proof submissions

**Route**: `/admin/validate-income`

**Layout:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HEADER:
  - Title: "ğŸ’° VALIDASI PEMASUKKAN"
  - Font: Bold, 24px
  - Margin bottom: 8px
  
  Subtitle:
    - Text: "Review bukti transfer yang dikirim member"
    - Font: Regular, 14px
    - Color: Gray
    - Margin bottom: 24px

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PENDING ITEMS LIST (Vertical stack, gap 16px):

If pending submissions exist:

  Each submission card:
    - Width: 100%
    - Max-width: 800px
    - Background: White
    - Border: 2px solid orange (#F59E0B)
    - Border radius: 12px
    - Padding: 24px
    - Shadow: Elevation
    
    Layout (Horizontal on desktop, Vertical on mobile):
      
      Left section (40% width):
        Proof image preview:
          - Width: 100%
          - Max-width: 300px
          - Aspect ratio: 1:1 (square crop)
          - Border: 1px solid gray
          - Border radius: 8px
          - Click: Open full-size image modal
          - Label: "Bukti Transfer" (above image)
      
      Right section (60% width):
        Form fields (Vertical stack):
          
          Submitted info (if available):
            - Text: "Submitted: [datetime]"
            - Font: Small, 12px, Gray
            - Margin bottom: 12px
          
          Amount input:
            - Label: "Jumlah Transfer *"
            - Type: Number
            - Prefix: "Rp"
            - Placeholder: "50000"
            - Default: Pre-filled if user submitted
            - Validation: Required, min 10000
            - Margin bottom: 12px
          
          Transfer date input:
            - Label: "Tanggal Transfer *"
            - Type: DateTime picker
            - Default: Today
            - Validation: Cannot be future date
            - Margin bottom: 12px
          
          Target assignment:
            - Label: "Alokasi Dana *"
            - Type: Dropdown
            - Options:
              * Active target (if exists): "[Month Year] - [N] wisudawan"
              * "Dompet Bersama" (if no active target or manual choice)
            - Default: Auto-select active target
            - Margin bottom: 12px
          
          Description (optional):
            - Label: "Catatan Tambahan"
            - Type: Textarea
            - Placeholder: "Opsional - catatan untuk transaksi ini"
            - Max length: 200 chars
            - Margin bottom: 20px
          
          Action buttons (Horizontal, gap 12px):
            
            Approve button:
              - Text: "âœ… Approve & Tambahkan"
              - Background: Green (#16A34A)
              - Color: White
              - Height: 44px
              - Width: 60%
              - Font: Bold, 14px
              - Click: Validate, create transaction, delete submission
            
            Reject button:
              - Text: "âŒ Tolak"
              - Background: Red (#DC2626)
              - Color: White
              - Height: 44px
              - Width: 40%
              - Font: Medium, 14px
              - Click: Open rejection reason modal, then delete submission

If no pending submissions:
  Empty state:
    - Icon: "âœ…" (64px)
    - Title: "Semua pemasukkan tervalidasi!"
    - Text: "Tidak ada bukti transfer yang menunggu review"
    - Center-aligned
    - Background: Light green (#DCFCE7)
    - Border: 1px solid green (#86EFAC)
    - Border radius: 12px
    - Padding: 40px

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Approve Logic**:
```dart
Future<void> approveIncome(Submission submission, FormData data) async {
  final batch = FirebaseFirestore.instance.batch();
  
  // 1. Create transaction document
  final transactionRef = FirebaseFirestore.instance.collection('transactions').doc();
  batch.set(transactionRef, {
    'id': transactionRef.id,
    'type': 'income',
    'amount': data.amount,
    'target_id': data.targetId,
    'target_month': data.targetMonth,
    'description': data.description ?? 'Transfer dari member',
    'proof_url': submission.proofUrl,
    'validated': true,
    'validation_status': 'approved',
    'created_at': Timestamp.fromDate(data.transferDate),
    'input_at': Timestamp.now(),
    'created_by': currentAdmin.email,
    'metadata': {
      'submitted_by': submission.submittedBy,
      'submission_method': 'web',
    }
  });
  
  // 2. Update target current_amount (if not general fund)
  if (data.targetId != 'general_fund') {
    final targetRef = FirebaseFirestore.instance
      .collection('graduation_targets')
      .doc(data.targetId);
    batch.update(targetRef, {
      'current_amount': FieldValue.increment(data.amount),
      'updated_at': Timestamp.now(),
    });
  } else {
    // Update general fund
    final gfRef = FirebaseFirestore.instance
      .collection('general_fund')
      .doc('current');
    batch.update(gfRef, {
      'balance': FieldValue.increment(data.amount),
      'total_income': FieldValue.increment(data.amount),
      'transaction_count': FieldValue.increment(1),
      'last_updated': Timestamp.now(),
      'last_transaction_id': transactionRef.id,
    });
  }
  
  // 3. Delete pending submission
  final submissionRef = FirebaseFirestore.instance
    .collection('pending_submissions')
    .doc(submission.id);
  batch.delete(submissionRef);
  
  // Execute batch
  await batch.commit();
  
  // Show success message
  showSuccessToast('âœ… Pemasukkan berhasil ditambahkan!');
}
```

**Reject Logic**:
```dart
Future<void> rejectIncome(Submission submission, String reason) async {
  // Update submission status
  await FirebaseFirestore.instance
    .collection('pending_submissions')
    .doc(submission.id)
    .update({
      'status': 'rejected',
      'reviewed_at': Timestamp.now(),
      'reviewed_by': currentAdmin.email,
      'notes': reason,
    });
  
  // Optionally: Delete proof image from Storage
  // await FirebaseStorage.instance.refFromURL(submission.proofUrl).delete();
  
  showSuccessToast('Submission ditolak');
}
```

---

## ADMIN VIEW 3: INPUT EXPENSE

**Purpose**: Add expense transactions from general fund

**Route**: `/admin/input-expense`

**Layout:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HEADER:
  - Title: "ğŸ“¤ INPUT PENGELUARAN"
  - Font: Bold, 24px
  - Margin bottom: 8px
  
  Subtitle:
    - Text: "Catat pengeluaran dana dari dompet bersama"
    - Font: Regular, 14px
    - Color: Gray
    - Margin bottom: 24px

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CURRENT BALANCE DISPLAY:
  Container:
    - Background: Light blue (#EFF6FF)
    - Border: 1px solid blue (#BFDBFE)
    - Border radius: 8px
    - Padding: 16px
    - Margin bottom: 24px
  
  Content:
    - Text: "ğŸ’° Saldo Tersedia: Rp [general_fund_balance]"
    - Font: Bold, 18px
    - Color: Teal (#14b8a6)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EXPENSE FORM:
  Container:
    - Width: 100%
    - Max-width: 600px
    - Background: White
    - Border radius: 12px
    - Padding: 32px
    - Shadow: Elevation
  
  Form fields (Vertical stack, gap 20px):
    
    1. Amount input:
       - Label: "Jumlah Pengeluaran *"
       - Type: Number
       - Prefix: "Rp"
       - Placeholder: "100000"
       - Validation:
         * Required
         * Min: 1000
         * Max: Current general fund balance
         * Error: "Saldo tidak cukup" (if exceeds balance)
    
    2. Category dropdown:
       - Label: "Kategori *"
       - Options:
         * "ğŸ“ Wisuda" â†’ "wisuda"
         * "ğŸ• Komunitas" â†’ "community"
         * "âš™ï¸ Operasional" â†’ "operational"
         * "ğŸ“¦ Lainnya" â†’ "others"
       - Default: "wisuda"
       - Validation: Required
    
    3. Description textarea:
       - Label: "Deskripsi Pengeluaran *"
       - Placeholder: "Contoh: Bunga wisuda - Faris"
       - Rows: 3
       - Max length: 200 chars
       - Character counter: "[X]/200"
       - Validation:
         * Required
         * Min length: 10 chars
         * Error: "Deskripsi minimal 10 karakter"
    
    4. Proof upload:
       - Label: "Bukti Pengeluaran (Struk/Receipt) *"
       - Type: File picker
       - Accepted: .jpg, .jpeg, .png
       - Max size: 5MB
       - Display:
         * Upload button: "ğŸ“ Pilih File"
         * Preview: Thumbnail (100x100) + file name + size
         * Remove button: "âŒ" (if file selected)
       - Validation:
         * Required
         * File size check
         * File type check
    
    5. Transaction date:
       - Label: "Tanggal Pengeluaran *"
       - Type: DateTime picker
       - Default: Today
       - Validation:
         * Required
         * Cannot be future date
         * Warning if > 7 days ago: "Transaksi lebih dari 7 hari lalu"
    
    Action buttons (Horizontal, gap 12px):
      
      Cancel button:
        - Text: "âŒ Batal"
        - Background: Transparent
        - Border: 1px solid gray
        - Color: Gray
        - Height: 48px
        - Width: 30%
        - Click: Clear form
      
      Submit button:
        - Text: "ğŸ’¾ Simpan Pengeluaran"
        - Background: Red (#DC2626)
        - Color: White
        - Height: 48px
        - Width: 70%
        - Font: Bold, 16px
        - Disabled: If form invalid or submitting
        - Loading state: Spinner + "Menyimpan..."
        - Click: Upload proof, create transaction, update general fund

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RECENT EXPENSES TABLE (Below form):
  - Header: "Pengeluaran Terbaru"
  - Display: Last 10 expense transactions
  - Columns: Amount | Category | Description | Date | Proof
  - Action: View/Delete (within 24h only)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Submit Logic**:
```dart
Future<void> submitExpense(FormData data) async {
  // 1. Validate balance
  final gfDoc = await FirebaseFirestore.instance
    .collection('general_fund')
    .doc('current')
    .get();
  final currentBalance = gfDoc.data()!['balance'];
  
  if (data.amount > currentBalance) {
    throw Exception('Saldo tidak cukup!');
  }
  
  // 2. Upload proof image to Storage
  final storageRef = FirebaseStorage.instance
    .ref()
    .child('proof_images')
    .child('expense_${DateTime.now().millisecondsSinceEpoch}.jpg');
  
  await storageRef.putFile(data.proofFile);
  final proofUrl = await storageRef.getDownloadURL();
  
  // 3. Create transaction & update general fund (batch)
  final batch = FirebaseFirestore.instance.batch();
  
  final transactionRef = FirebaseFirestore.instance
    .collection('transactions')
    .doc();
  
  batch.set(transactionRef, {
    'id': transactionRef.id,
    'type': 'expense',
    'amount': data.amount,
    'target_id': 'general_fund',
    'category': data.category,
    'description': data.description,
    'proof_url': proofUrl,
    'validated': true,
    'created_at': Timestamp.fromDate(data.transactionDate),
    'input_at': Timestamp.now(),
    'created_by': currentAdmin.email,
  });
  
  final gfRef = FirebaseFirestore.instance
    .collection('general_fund')
    .doc('current');
  
  batch.update(gfRef, {
    'balance': FieldValue.increment(-data.amount),
    'total_expense': FieldValue.increment(data.amount),
    'transaction_count': FieldValue.increment(1),
    'last_updated': Timestamp.now(),
    'last_transaction_id': transactionRef.id,
  });
  
  await batch.commit();
  
  // 4. Clear form and show success
  clearForm();
  showSuccessToast('âœ… Pengeluaran berhasil dicatat!');
}
```

---

## ADMIN VIEW 4: MANAGE TARGETS

**Purpose**: Create, edit, view graduation targets

**Route**: `/admin/manage-targets`

**Layout:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HEADER:
  - Title: "ğŸ¯ KELOLA TARGET WISUDA"
  - Font: Bold, 24px
  - Margin bottom: 24px

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 1: ACTIVE TARGET (If exists)

Card:
  - Background: White
  - Border: 2px solid teal
  - Border radius: 12px
  - Padding: 24px
  - Margin bottom: 24px
  
  Header:
    - Text: "ğŸ“Œ TARGET AKTIF"
    - Font: Bold, 16px
    - Margin bottom: 16px
  
  Content:
    Display (Read-only):
      - Month & Year
      - Number of graduates
      - Current amount / Target amount
      - Progress percentage
      - Deadline
      - Status
      - List of graduates (name, date, location)
    
    Actions:
      - Button: "âœï¸ Edit Graduate List"
        * Opens modal to add/remove graduates
        * Can adjust dates/locations
      
      - Button: "ğŸš« Manual Close" (Emergency only)
        * Confirmation dialog
        * Warning: "This will close target before deadline"
        * Only use if critical issue
      
      - Button: "ğŸ“Š View Statistics"
        * Shows detailed breakdown
        * Income list for this target
        * Distribution calculation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 2: UPCOMING TARGETS

Header:
  - Text: "ğŸ”’ TARGET MENDATANG"
  - Font: Bold, 16px
  - Margin bottom: 12px

List of upcoming targets (if any):
  Each card (similar to active but lighter styling):
    - Display: Month, graduates, target amount, will open date
    - Actions: Edit, Delete (before activation only)

If no upcoming:
  - Text: "Tidak ada target mendatang"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 3: CREATE NEW TARGET

Header:
  - Text: "â• BUAT TARGET BARU"
  - Font: Bold, 16px
  - Margin bottom: 16px

Form container:
  - Background: White
  - Border radius: 12px
  - Padding: 32px
  
  Form fields:
    
    1. Month & Year selector:
       - Label: "Bulan & Tahun Wisuda *"
       - Type: Month picker (or separate dropdowns)
       - Validation:
         * Required
         * Cannot be duplicate (check existing targets)
         * Cannot be past month
    
    2. Graduate list builder:
       - Label: "Daftar Wisudawan *"
       - Dynamic form: Can add multiple rows
       
       Each row (Horizontal):
         - Name input (text, required)
         - Date input (datepicker, required, must be in selected month)
         - Location input (text, required)
         - Remove button (if > 1 row)
       
       - Button: "â• Tambah Wisudawan"
         * Adds new row
         * No limit on number of graduates
       
       - Validation:
         * At least 1 graduate required
         * All dates must be in selected month
         * Names cannot be duplicate
    
    3. Auto-calculated fields (Display only):
       - Target amount: "[N graduates] Ã— Rp 250.000 = Rp [total]"
       - Deadline: "[Earliest date] - 3 days = [deadline date]"
       - Font: Medium, 14px, Teal color
    
    Action buttons:
      - Cancel: Clear form
      - Create: Validate and create target document

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 4: ARCHIVED TARGETS

Header:
  - Text: "ğŸ“¦ TARGET SELESAI"
  - Font: Bold, 16px
  - Collapsible: Click to expand/collapse
  - Default: Collapsed

List (when expanded):
  - Display past targets (status: closed or archived)
  - Read-only cards
  - Shows: Month, graduates, final amount, distribution
  - Action: View report (Phase 2 feature)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Create Target Logic**:
```dart
Future<void> createTarget(FormData data) async {
  // 1. Validate month/year not duplicate
  final existing = await FirebaseFirestore.instance
    .collection('graduation_targets')
    .where('month', isEqualTo: data.month.toLowerCase())
    .where('year', isEqualTo: data.year)
    .get();
  
  if (existing.docs.isNotEmpty) {
    throw Exception('Target untuk bulan ini sudah ada!');
  }
  
  // 2. Calculate values
  final targetAmount = data.graduates.length * 250000;
  final earliestDate = data.graduates
    .map((g) => g.date)
    .reduce((a, b) => a.isBefore(b) ? a : b);
  final deadline = earliestDate.subtract(Duration(days: 3));
  
  // 3. Determine initial status
  String status;
  final hasActiveTarget = await _hasActiveTarget();
  
  if (!hasActiveTarget) {
    status = 'active';  // Auto-activate if no active target exists
  } else {
    status = 'upcoming';  // Queue for later
  }
  
  // 4. Create target document
  final targetRef = FirebaseFirestore.instance
    .collection('graduation_targets')
    .doc();
  
  await targetRef.set({
    'id': targetRef.id,
    'month': data.month.toLowerCase(),
    'year': data.year,
    'graduates': data.graduates.map((g) => {
      'name': g.name,
      'date': Timestamp.fromDate(g.date),
      'location': g.location,
    }).toList(),
    'target_amount': targetAmount,
    'current_amount': 0,
    'deadline': Timestamp.fromDate(deadline),
    'status': status,
    'open_date': status == 'active' ? Timestamp.now() : null,
    'closed_date': null,
    'distribution': {
      'per_person': 0,
      'total_distributed': 0,
      'status': 'pending',
      'distributed_at': null,
    },
    'created_at': Timestamp.now(),
    'created_by': currentAdmin.email,
    'updated_at': Timestamp.now(),
  });
  
  // 5. If auto-activated, transfer general fund
  if (status == 'active') {
    await _transferGeneralFundToTarget(targetRef.id);
  }
  
  showSuccessToast('âœ… Target berhasil dibuat!');
  clearForm();
}
```

---

## ADMIN VIEW 5: SETTINGS

**Purpose**: Configure payment info, system settings, admin account

**Route**: `/admin/settings`

**Layout:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HEADER:
  - Title: "âš™ï¸ PENGATURAN"
  - Font: Bold, 24px
  - Margin bottom: 24px

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 1: PAYMENT INFO

Container:
  - Background: White
  - Border radius: 12px
  - Padding: 32px
  - Margin bottom: 24px

Header:
  - Text: "ğŸ’³ INFORMASI PEMBAYARAN"
  - Font: Bold, 18px
  - Margin bottom: 16px

Form fields:
  
  1. Bank name:
     - Label: "Nama Bank *"
     - Type: Text input
     - Placeholder: "BCA"
     - Current value: From Firestore
  
  2. Account number:
     - Label: "Nomor Rekening *"
     - Type: Text input
     - Placeholder: "1234567890"
     - Current value: From Firestore
  
  3. Account holder name:
     - Label: "Atas Nama *"
     - Type: Text input
     - Placeholder: "Adrian Marcell"
     - Current value: From Firestore
  
  4. QR code upload:
     - Label: "QR Code QRIS"
     - Type: File picker
     - Accepted: .jpg, .jpeg, .png
     - Max size: 2MB
     - Display:
       * Current QR preview (if exists)
       * Upload button: "ğŸ“ Upload QR Baru"
       * Remove button: "âŒ Hapus QR"

Action buttons:
  - Cancel: Revert changes
  - Save: "ğŸ’¾ Simpan Perubahan" (Teal background)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 2: SYSTEM CONFIGURATION

Container: (same styling as Section 1)

Header:
  - Text: "âš™ï¸ KONFIGURASI SISTEM"

Form fields:
  
  1. Per-person allocation:
     - Label: "Alokasi Per Wisudawan"
     - Type: Number input
     - Prefix: "Rp"
     - Default: 250000
     - Validation: Min 10000, Max 10000000
     - Info text: "Jumlah dana untuk setiap wisudawan"
  
  2. Deadline offset:
     - Label: "Deadline Offset (Hari)"
     - Type: Number input
     - Default: 3
     - Validation: Min 1, Max 30
     - Info text: "Target ditutup H-[X] sebelum wisuda pertama"
  
  3. Minimum contribution:
     - Label: "Kontribusi Minimum"
     - Type: Number input
     - Prefix: "Rp"
     - Default: 10000
     - Validation: Min 1000
     - Info text: "Jumlah minimum untuk setiap donasi"

Action buttons: (same as Section 1)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 3: ADMIN ACCOUNT

Container: (same styling)

Header:
  - Text: "ğŸ‘¤ AKUN ADMIN"

Display fields (Read-only):
  - Email: [admin email]
  - Last login: [datetime]

Action:
  - Button: "ğŸ”‘ Ubah Password"
    * Opens modal with:
      - Current password input
      - New password input
      - Confirm new password input
    * Validation: Passwords must match, min 8 chars
    * Submit: Update Firebase Auth password

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECTION 4: DANGER ZONE

Container:
  - Background: Light red (#FEE2E2)
  - Border: 2px solid red (#EF4444)
  - Border radius: 12px
  - Padding: 24px

Header:
  - Text: "âš ï¸ DANGER ZONE"
  - Font: Bold, 16px
  - Color: Red
  - Margin bottom: 12px

Warning text:
  - "Tindakan di bawah ini tidak dapat dibatalkan!"
  - Font: Regular, 13px
  - Color: Dark red

Actions:
  
  1. Export database:
     - Button: "ğŸ“¥ Export Data (JSON)"
     - Background: Orange
     - Click: Download Firestore data as JSON backup
  
  2. Reset all data:
     - Button: "ğŸ—‘ï¸ Reset Semua Data"
     - Background: Red
     - Click: Confirmation dialog with:
       * "Ketik 'RESET' untuk konfirmasi"
       * Text input (must match "RESET")
       * Warning: All data will be permanently deleted
       * Confirm button: Execute reset (delete all collections)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Update Settings Logic**:
```dart
Future<void> updatePaymentInfo(PaymentFormData data) async {
  String? qrCodeUrl = currentQrCodeUrl;
  
  // Upload new QR if file selected
  if (data.qrFile != null) {
    final storageRef = FirebaseStorage.instance
      .ref()
      .child('qr_codes')
      .child('qris_${DateTime.now().millisecondsSinceEpoch}.png');
    
    await storageRef.putFile(data.qrFile!);
    qrCodeUrl = await storageRef.getDownloadURL();
    
    // Delete old QR (optional)
    if (currentQrCodeUrl != null) {
      await FirebaseStorage.instance.refFromURL(currentQrCodeUrl).delete();
    }
  }
  
  // Update Firestore
  await FirebaseFirestore.instance
    .collection('settings')
    .doc('app_config')
    .update({
      'payment_info': {
        'bank_name': data.bankName,
        'account_number': data.accountNumber,
        'account_name': data.accountName,
        'qr_code_url': qrCodeUrl,
      },
      'updated_at': Timestamp.now(),
      'updated_by': currentAdmin.email,
    });
  
  showSuccessToast('âœ… Informasi pembayaran berhasil diupdate!');
}
```

---

## ADDITIONAL ADMIN FEATURES

### Edit Graduate List Modal

**Trigger**: Click "Edit Graduate List" in active target

**Modal content**:
```
Title: "âœï¸ EDIT DAFTAR WISUDAWAN"

List of current graduates (editable):
  - Each row: Name | Date | Location | Remove button
  - Can edit in-place
  - Can add new rows
  - Can remove rows (min 1 graduate must remain)

Warning:
  - "âš ï¸ Mengubah daftar wisudawan akan mempengaruhi target amount dan deadline"
  - Auto-recalculate on changes

Action buttons:
  - Cancel: Close without saving
  - Save: Update target document, recalculate target_amount & deadline
```

### View Proof Image Modal

**Trigger**: Click "View Proof" in transactions

**Modal content**:
```
Full-screen overlay:
  - Black background (80% opacity)
  - Centered image (max 90% viewport)
  - Close button (top-right)
  - Zoom controls (optional)
  - Download button
```

### Delete Confirmation Dialog

**Trigger**: Click "Delete" on transaction (within 24h only)

**Modal content**:
```
Title: "âš ï¸ KONFIRMASI HAPUS"

Message:
  - "Apakah Anda yakin ingin menghapus transaksi ini?"
  - Transaction details display
  - Warning: "Tindakan ini tidak dapat dibatalkan"

Buttons:
  - Cancel (gray)
  - Confirm Delete (red)
```

**Delete Logic**:
```dart
Future<void> deleteTransaction(Transaction tx) async {
  final batch = FirebaseFirestore.instance.batch();
  
  // 1. Delete transaction document
  final txRef = FirebaseFirestore.instance
    .collection('transactions')
    .doc(tx.id);
  batch.delete(txRef);
  
  // 2. Revert amount changes
  if (tx.type == 'income') {
    if (tx.targetId != 'general_fund') {
      // Decrease target current_amount
      final targetRef = FirebaseFirestore.instance
        .collection('graduation_targets')
        .doc(tx.targetId);
      batch.update(targetRef, {
        'current_amount': FieldValue.increment(-tx.amount),
      });
    } else {
      // Decrease general fund
      final gfRef = FirebaseFirestore.instance
        .collection('general_fund')
        .doc('current');
      batch.update(gfRef, {
        'balance': FieldValue.increment(-tx.amount),
        'total_income': FieldValue.increment(-tx.amount),
      });
    }
  } else {
    // Expense: Refund to general fund
    final gfRef = FirebaseFirestore.instance
      .collection('general_fund')
      .doc('current');
    batch.update(gfRef, {
      'balance': FieldValue.increment(tx.amount),
      'total_expense': FieldValue.increment(-tx.amount),
    });
  }
  
  await batch.commit();
  
  showSuccessToast('Transaksi berhasil dihapus');
}
```

---

## RESPONSIVE ADMIN LAYOUT

### Mobile (<600px)
- Sidebar: Hidden by default, show as drawer overlay
- Navbar: Hamburger menu icon to toggle sidebar
- Content: Full width, single column
- Tables: Horizontal scroll or stack vertically
- Forms: Single column layout
- Metrics cards: 1 per row

### Tablet (600-1024px)
- Sidebar: Collapsible (icon-only mode option)
- Content: Adjusted padding
- Metrics cards: 2 per row
- Tables: Horizontal scroll if needed

### Desktop (>1024px)
- Sidebar: Fixed, always visible
- Content: Max-width containers
- Metrics cards: 4 per row
- Tables: Full width, no scroll

---

## ADMIN PERMISSIONS & SECURITY

### Route Guards

```dart
// Wrap admin routes with auth guard
class AdminGuard extends StatelessWidget {
  final Widget child;
  
  Widget build(BuildContext context) {
    return StreamBuilder<User?>(
      stream: FirebaseAuth.instance.authStateChanges(),
      builder: (context, snapshot) {
        if (snapshot.connectionState == ConnectionState.waiting) {
          return LoadingScreen();
        }
        
        if (snapshot.hasData && snapshot.data!.email == 'admin@example.com') {
          return child;  // Admin authenticated
        } else {
          return AdminLoginPage();  // Redirect to login
        }
      },
    );
  }
}
```

### Firestore Rules (Admin writes)

```javascript
// Already covered in Phase 1, but reminder:
function isAdmin() {
  return request.auth != null && 
         request.auth.token.email == 'admin@example.com';
}

// All write operations require isAdmin() check
```

---

## DELIVERABLES FOR PHASE 2

**Please generate:**

1. **Admin authentication screen** (`/lib/screens/admin/login.dart`)
2. **Admin dashboard layout** (`/lib/screens/admin/dashboard_layout.dart`)
3. **Dashboard overview view** (`/lib/screens/admin/views/dashboard_overview.dart`)
4. **Validate income view** (`/lib/screens/admin/views/validate_income.dart`)
5. **Input expense view** (`/lib/screens/admin/views/input_expense.dart`)
6. **Manage targets view** (`/lib/screens/admin/views/manage_targets.dart`)
7. **Settings view** (`/lib/screens/admin/views/settings.dart`)
8. **Admin-specific widgets** (`/lib/widgets/admin/`)
   - Sidebar navigation
   - Metric cards
   - Transaction table
   - Modals (proof viewer, edit graduate list, etc.)
9. **Admin providers** (`/lib/providers/admin/`)
   - Pending submissions provider
   - Admin actions controller
10. **Updated README** with admin setup & usage instructions

---

**END OF PROMPT 2**

This completes the admin panel implementation. After Phase 2, we'll move to Prompt 3 for Cloud Functions and automation.
```

---